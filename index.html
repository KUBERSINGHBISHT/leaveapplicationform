<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fc;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            height: 100vh;
            color: #333;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 30px;
        }

        .form-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }

        .form-container label {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            color: #555;
        }

        .voucher label {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            color: black;
            margin-left: 13.5px;
        }

        .signature-row label {
            margin-left: 0px;
        }

        .voucher span {
            margin-left: 13.5px;
        }

        .form-container input, .form-container select, .form-container button {
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
            width: 100%;
            margin: 5px 0;
            box-sizing: border-box;
        }

        .form-container button {
            background-color: #4CAF50;
            color: white;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .form-container button:hover {
            background-color: #45a049;
        }

        .voucher {
            display: none;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            border: double;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .voucher h2 {
            color: #4CAF50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .voucher div {
            margin-bottom: 15px;
        }

        .signature-row {
            display: flex;
            justify-content: space-between; 
            gap: 20px;
            text-align: center;
            padding-bottom: 0px;
        }

        .signature-item {
            flex: 1; 
        }

        .signature-box {
            width: 185px; 
            height: 100px;
            border: 1px solid black; 
            background-color: #f0f0f0;
            margin-top: 5px;
            border-radius: 20px;
        }

        .print-button {
            display: block;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
        }

        .print-button:hover {
            background-color: #45a049;
        }

        #message {
            width: 200px;
            padding: 100px;
            background-color: rgb(125, 218, 125);
            color: white;
            text-align: center;
            border-radius: 5px;
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            font-size: 20px;
        }

        #okBtn {
            margin-top: 10px;
            padding: 5px 10px;
            border: none;
            background-color: rgb(117, 196, 117);
            color: white;
            cursor: pointer;
            border-radius: 3px;
            width: 60px;
            height: 40px;
        }
        
        #okBtn:hover {
            background-color: green;
        }

        @media print {
            .print-button {
                display: none;
            }
        }
        
        @media screen and (max-width: 768px) {
            .voucher {
                padding: 15px;
                width: 95%;
            }

            .voucher h2 {
                font-size: 1.5rem;
            }

            .signature-row {
                gap: 20px;
            }

            .signature-box {
                width: 100px;
                height: 80px;
            }

            .print-button {
                font-size: 1rem;
                padding: 8px 16px;
            }
            
            .form-container {
            max-width: 350px;
            }
            
            body {
            margin-left: 10px;
            margin-right: 10px;
            }

            #message {
            width: 150px;
            padding: 70px;
            }

        }

        @media screen and (max-width: 480px) {
            .voucher h2 {
                font-size: 1.2rem;
            }

            label {
                font-size: 0.9rem;
            }

            .signature-box {
                height: 70px;
            }

            .print-button {
                font-size: 0.9rem;
                padding: 6px 12px;
            }

            #message {
            width: 150px;
            padding: 70px;
            }
        }

        .newone {
            display: flex;
            flex-direction: row;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .newone a{
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            width: 150px;
            height: 25px;
            text-align: center;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <script>
        var rnum = "";

        function handleReasonChange() {
                const leaveReason = document.getElementById("leaveReason").value;
            const otherReasonDiv = document.getElementById("otherReasonDiv");
            const otherReasonInput = document.getElementById("otherReason");
            
            if (leaveReason === "Other") {
                otherReasonDiv.style.display = "block"; // Show the text box
                otherReasonInput.setAttribute("required", "required");
            } else {
                otherReasonDiv.style.display = "none"; // Hide the text box
                otherReasonInput.removeAttribute("required");
            }
        }

    </script>
    <div class="form-container" id="formContainer">
        <h1>Leave Application Form</h1>
        <form method="post" id="leaveForm">
            <label for="company">Company Name:</label>
            <select id="company" name="company" required>
                <option value="">Select Company</option>
                <option value="Monsoon Agrochemicals Pvt. Ltd.">Monsoon</option>
                <option value="Oswal Crop Protection Pvt. Ltd.">Oswal</option>
                <option value="Luchem Crop Science Pvt. Ltd.">Luchem</option>
                <option value="Nutribio Fertiliser Pvt. Ltd.">Nutribio</option>
            </select>
            <label for="applicationDate">Application Date:</label>
            <input type="date" id="applicationDate" name="applicationDate" required disabled>
            
            <label for="name">Name:</label>
            <div class="newone">
            <select id="name-select" name="name" required>
                <option value="">Data Loading...</option>
            </select>
            <a href="./nameRegisterd.html">New User</a>
            </div>
            
            <label for="department">Department:</label>
            <select id="department" name="department" required>
                <option value="">Select Department</option>
                <option value="Accounts">Accounts</option>
                <option value="Admin">Admin</option>
                <option value="Designing">Designing</option>
                <option value="Finance">Finance</option>
                <option value="HR Departments">HR Departments</option>
                <option value="IT Sector">IT Sector</option>
                <option value="Production">Production</option>
                <option value="Purchase">Purchase</option>
                <option value="Quality Control">Quality Control</option>
                <option value="Regulatory Affairs">Regulatory Affairs</option>
                <option value="Research & Developer">Research & Developer</option>
                <option value="Sales & Marketing">Sales & Marketing</option>
                <option value="Supply Chain">Supply Chain</option>
                <option value="Legal">Legal</option>
                <option value="IPR & Trade Mark">IPR & Trade Mark</option>
            </select>

            <label for="leaveType">Leave Requested For:</label>
            <select id="leaveType" name="leaveType" required>
                <option value="">Select Leave Type</option>
                <option value="Morning Short Leave (10:00 am to 12:30 pm)">Morning Short Leave (10:00 am to 12:30 pm)</option>
                <option value="Evening Short Leave  (04:00 pm to 06:30 pm)">Evening Short Leave  (04:00 pm to 06:30 pm)</option>
                <option value="First Half Leave (10:00 am to 02:00 pm)">First Half Leave (10:00 am to 02:00 pm)</option>
                <option value="Second Half Leave (02:00 pm to 06:30 pm)">Second Half Leave (02:00 pm to 06:30 pm)</option>
                <option value="Full Day">Full Day</option>
                <option value="OD">OD</option>
            </select>

            <label for="leaveReason">Reason For Leave:</label>
            <select id="leaveReason" name="leaveReason" required onchange="handleReasonChange()">
                <option value="">Select Reason</option>
                <option value="Personal">Personal</option>
                <option value="Sick">Sick</option>
                <option value="Planned">Planned</option>
                <option value="Other">Other</option>
            </select>

            <div id="otherReasonDiv" style="display: none; margin-top: 10px;">
                <label for="otherReason">Please specify:</label>
                <input type="text" id="otherReason" name="otherReason1">
            </div>

            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate" required>
            
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate" required>
            
            <label for="emergencyContact">Emergency Contact Number:</label>
            <input type="tel" id="emergencyContact" name="emergencyContact" placeholder="Enter emergency contact number" pattern="[0-9]{10}" required>

            <label for="email">Email ID:</label>
            <input type="email" id="email" name="email" required>

            <button  id="add_button1">Submit Application</button>
        </form>
    </div>

    <div class="voucher" id="voucher">
        <div style="text-align: center; font-size: 35px; font-weight: bold; border-bottom: 2px solid; padding-bottom: 10px;"><span id="companyvoucher"></span></div>
        <h2>Leave Application Voucher</h2>
        <div><label>Application Date:</label> <span id="applicationDatev"></span></div>
        <div><label>Name:</label> <span id="voucherName"></span></div>
        <div><label>Department:</label> <span id="voucherDepartment"></span></div>
        <div><label>Leave Requested For:</label> <span id="voucherLeaveType"></span></div>
        <div><label>Reason For Leave:</label> <span id="voucherLeaveReason"></span></div>
        <div><label>Start Date:</label> <span id="voucherStartDate"></span></div>
        <div><label>End Date:</label> <span id="voucherEndDate"></span></div>
        <div><label>Emergency Contact No.:</label> <span id="voucherContact"></span></div>
        <div><label>Email ID:</label> <span id="voucheremail"></span></div>
        <div class="signature-row" style="margin-bottom: 0px;">
            <div class="signature-item" style="margin-bottom: 0px;">
                <label>Employee Signature:</label>
                <div class="signature-box"></div>
            </div>
            <div class="signature-item" style="margin-bottom: 0px;">
                <label>HOD Signature:</label>
                <div class="signature-box"></div>
            </div>
            <div class="signature-item" style="margin-bottom: 0px;">
                <label>HR Signature:</label>
                <div class="signature-box"></div>
            </div>
        </div>
        <button class="print-button" onclick="window.print()">Print</button>
    </div>
    <div id="message">
        <p id="messageText">Data submitting...</p>
        <button id="okBtn" style="display: none;">OK</button>
    </div>
    <script>
        // Get the current date in YYYY-MM-DD format
        const today = new Date().toISOString().split('T')[0];
        // Set the default value of the input field to the current date
        document.getElementById('applicationDate').value = today;

        let url = 'https://script.google.com/macros/s/AKfycbzNKeZ6eabOoE0-c5JTdeRivixWuxqRew_qrYukPjjswUoJ9u0pHy8H6Knc3SNCAarPEg/exec';
        let form1 = document.querySelector('#leaveForm');
        let messageDiv = document.getElementById("message");
        let messageText = document.getElementById("messageText");
        let okBtn = document.getElementById("okBtn");

        form1.addEventListener("submit", (e) => {
            e.preventDefault();

            // Show the message box with "Data submitting..."
            messageText.textContent = "Data submitting...";
            messageDiv.style.display = "block";
            okBtn.style.display = "none"; // Hide OK button while submitting

            // Prepare form data
            let formData = new FormData(form1);
            formData.append("action", "addToSheet1");

            fetch(url, {
                method: "POST",
                body: formData
            })
                .then((res) => res.text())
                .then((finalRes) => {
                    messageText.textContent = finalRes; // Show the response message
                    okBtn.style.display = "block"; // Show OK button
                    

                     // Check if the response indicates success or duplicate entry
                     if (finalRes.toLowerCase().includes("this form already submitted!")) {
                        submissionSuccess = false; // Set flag for successful submission
                        messageDiv.style.backgroundColor = 'rgb(224, 129, 129)';
                        messageText.style.color = 'white';
                        okBtn.style.backgroundColor = 'rgb(210, 85, 85)';
                    } else {
                        submissionSuccess = true; // Stay on the page if duplicate
                    }
                })
                .catch((err) => {
                    messageText.textContent = "Error submitting data!";
                    okBtn.style.display = "block";
                    console.error("Error:", err);
                });
        });

        // On OK button click, redirect if success, otherwise stay
        okBtn.addEventListener("click", function() {
            messageDiv.style.display = "none";
            if (submissionSuccess) {
                const form = document.getElementById('leaveForm');
                const formContainer = document.getElementById('formContainer');
                const voucher = document.getElementById('voucher');
                
                const leaveReason = form.leaveReason.value;
                const otherReason = form.otherReason.value;

                const reasonToDisplay = leaveReason === "Other" ? otherReason : leaveReason;
                
                // Extract form data
                document.getElementById('companyvoucher').innerText = form.company.value;
                document.getElementById('voucherName').innerText = form.name.value;
                document.getElementById('voucherDepartment').innerText = form.department.value;
                document.getElementById('voucherLeaveType').innerText = form.leaveType.value;
                document.getElementById('voucherLeaveReason').innerText = reasonToDisplay;
                document.getElementById('voucherContact').innerText = form.emergencyContact.value;
                document.getElementById('voucheremail').innerText = form.email.value;
                const dateValue = form.startDate.value; // Get the date value from the form input
                const date = new Date(dateValue); // Convert to Date object
                const formattedDate = date.toLocaleDateString('en-GB'); // Format to 'dd/MM/yyyy'
                document.getElementById('voucherStartDate').innerText = formattedDate; // Update span
                const dateValue1 = form.endDate.value; // Get the date value from the form input
                const date1 = new Date(dateValue1); // Convert to Date object
                const formattedDate1 = date1.toLocaleDateString('en-GB'); // Format to 'dd/MM/yyyy'
                document.getElementById('voucherEndDate').innerText = formattedDate1; // Update span
                const dateValue2 = form.applicationDate.value; // Get the date value from the form input
                const date2 = new Date(dateValue2); // Convert to Date object
                const formattedDate2 = date2.toLocaleDateString('en-GB'); // Format to 'dd/MM/yyyy'
                document.getElementById('applicationDatev').innerText = formattedDate2; // Update span

                // Hide form and show voucher
                formContainer.style.display = 'none';
                voucher.style.display = 'block';
            }
        });

        let url1 = 'https://script.google.com/macros/s/AKfycbzNKeZ6eabOoE0-c5JTdeRivixWuxqRew_qrYukPjjswUoJ9u0pHy8H6Knc3SNCAarPEg/exec?action=fetchSheet2'
        fetch(url1)
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('name-select');
            select.innerHTML = ""; // Clear existing options

            // Add a placeholder option
            const placeholderOption = document.createElement('option');
            placeholderOption.value = "";
            placeholderOption.textContent = "Select your name";
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            select.appendChild(placeholderOption);

            // Check if data exists
            if (data.values && data.values.length > 0) {
            data.values.forEach((row, index) => {
                if (index > 0) { // Skip the header row if present
                const option = document.createElement('option');
                option.value = row[0]; // Assuming names are in the first column
                option.textContent = row[0]; // Display the name in the dropdown
                select.appendChild(option);
                }
            });
            } else {
            // If no data found, add a "No data" option
            const noDataOption = document.createElement('option');
            noDataOption.value = "";
            noDataOption.textContent = "No data found";
            noDataOption.disabled = true;
            select.appendChild(noDataOption);
            }
        })
        .catch(error => {
            console.error("Error fetching data:", error);
            const select = document.getElementById('name-select');
            select.innerHTML = ""; // Clear existing options
            const errorOption = document.createElement('option');
            errorOption.value = "";
            errorOption.textContent = "Error loading data";
            errorOption.disabled = true;
            select.appendChild(errorOption);
        });
    </script>
</body>
</html>
